"use strict";exports.id=9648,exports.ids=[9648],exports.modules={39648:(a,b,c)=>{c.d(b,{diagram:()=>D});var d,e=c(636362);c(381271),c(336146),c(840195),c(632702),c(709896),c(589484),c(796435),c(248057),c(853963);var f=c(71844),g=c(169142),h=c(15171),i=c(867428),j=c(997566),k=c(189395),l=(0,h.K2)(a=>a.append("circle").attr("class","start-state").attr("r",(0,g.D7)().state.sizeUnit).attr("cx",(0,g.D7)().state.padding+(0,g.D7)().state.sizeUnit).attr("cy",(0,g.D7)().state.padding+(0,g.D7)().state.sizeUnit),"drawStartState"),m=(0,h.K2)(a=>a.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",(0,g.D7)().state.textHeight).attr("class","divider").attr("x2",2*(0,g.D7)().state.textHeight).attr("y1",0).attr("y2",0),"drawDivider"),n=(0,h.K2)((a,b)=>{let c=a.append("text").attr("x",2*(0,g.D7)().state.padding).attr("y",(0,g.D7)().state.textHeight+2*(0,g.D7)().state.padding).attr("font-size",(0,g.D7)().state.fontSize).attr("class","state-title").text(b.id),d=c.node().getBBox();return a.insert("rect",":first-child").attr("x",(0,g.D7)().state.padding).attr("y",(0,g.D7)().state.padding).attr("width",d.width+2*(0,g.D7)().state.padding).attr("height",d.height+2*(0,g.D7)().state.padding).attr("rx",(0,g.D7)().state.radius),c},"drawSimpleState"),o=(0,h.K2)((a,b)=>{let c=(0,h.K2)(function(a,b,c){let d=a.append("tspan").attr("x",2*(0,g.D7)().state.padding).text(b);c||d.attr("dy",(0,g.D7)().state.textHeight)},"addTspan"),d=a.append("text").attr("x",2*(0,g.D7)().state.padding).attr("y",(0,g.D7)().state.textHeight+1.3*(0,g.D7)().state.padding).attr("font-size",(0,g.D7)().state.fontSize).attr("class","state-title").text(b.descriptions[0]).node().getBBox(),e=d.height,f=a.append("text").attr("x",(0,g.D7)().state.padding).attr("y",e+.4*(0,g.D7)().state.padding+(0,g.D7)().state.dividerMargin+(0,g.D7)().state.textHeight).attr("class","state-description"),i=!0,j=!0;b.descriptions.forEach(function(a){i||(c(f,a,j),j=!1),i=!1});let k=a.append("line").attr("x1",(0,g.D7)().state.padding).attr("y1",(0,g.D7)().state.padding+e+(0,g.D7)().state.dividerMargin/2).attr("y2",(0,g.D7)().state.padding+e+(0,g.D7)().state.dividerMargin/2).attr("class","descr-divider"),l=f.node().getBBox(),m=Math.max(l.width,d.width);return k.attr("x2",m+3*(0,g.D7)().state.padding),a.insert("rect",":first-child").attr("x",(0,g.D7)().state.padding).attr("y",(0,g.D7)().state.padding).attr("width",m+2*(0,g.D7)().state.padding).attr("height",l.height+e+2*(0,g.D7)().state.padding).attr("rx",(0,g.D7)().state.radius),a},"drawDescrState"),p=(0,h.K2)((a,b,c)=>{let d,e=(0,g.D7)().state.padding,f=2*(0,g.D7)().state.padding,h=a.node().getBBox(),i=h.width,j=h.x,k=a.append("text").attr("x",0).attr("y",(0,g.D7)().state.titleShift).attr("font-size",(0,g.D7)().state.fontSize).attr("class","state-title").text(b.id),l=k.node().getBBox().width+f,m=Math.max(l,i);m===i&&(m+=f);let n=a.node().getBBox();b.doc,d=j-e,l>i&&(d=(i-m)/2+e),Math.abs(j-n.x)<e&&l>i&&(d=j-(l-i)/2);let o=1-(0,g.D7)().state.textHeight;return a.insert("rect",":first-child").attr("x",d).attr("y",o).attr("class",c?"alt-composit":"composit").attr("width",m).attr("height",n.height+(0,g.D7)().state.textHeight+(0,g.D7)().state.titleShift+1).attr("rx","0"),k.attr("x",d+e),l<=i&&k.attr("x",j+(m-f)/2-l/2+e),a.insert("rect",":first-child").attr("x",d).attr("y",(0,g.D7)().state.titleShift-(0,g.D7)().state.textHeight-(0,g.D7)().state.padding).attr("width",m).attr("height",3*(0,g.D7)().state.textHeight).attr("rx",(0,g.D7)().state.radius),a.insert("rect",":first-child").attr("x",d).attr("y",(0,g.D7)().state.titleShift-(0,g.D7)().state.textHeight-(0,g.D7)().state.padding).attr("width",m).attr("height",n.height+3+2*(0,g.D7)().state.textHeight).attr("rx",(0,g.D7)().state.radius),a},"addTitleAndBox"),q=(0,h.K2)(a=>(a.append("circle").attr("class","end-state-outer").attr("r",(0,g.D7)().state.sizeUnit+(0,g.D7)().state.miniPadding).attr("cx",(0,g.D7)().state.padding+(0,g.D7)().state.sizeUnit+(0,g.D7)().state.miniPadding).attr("cy",(0,g.D7)().state.padding+(0,g.D7)().state.sizeUnit+(0,g.D7)().state.miniPadding),a.append("circle").attr("class","end-state-inner").attr("r",(0,g.D7)().state.sizeUnit).attr("cx",(0,g.D7)().state.padding+(0,g.D7)().state.sizeUnit+2).attr("cy",(0,g.D7)().state.padding+(0,g.D7)().state.sizeUnit+2)),"drawEndState"),r=(0,h.K2)((a,b)=>{let c=(0,g.D7)().state.forkWidth,d=(0,g.D7)().state.forkHeight;if(b.parentId){let a=c;c=d,d=a}return a.append("rect").style("stroke","black").style("fill","black").attr("width",c).attr("height",d).attr("x",(0,g.D7)().state.padding).attr("y",(0,g.D7)().state.padding)},"drawForkJoinState"),s=(0,h.K2)((a,b,c,d)=>{let e=0,f=d.append("text");f.style("text-anchor","start"),f.attr("class","noteText");let h=a.replace(/\r\n/g,"<br/>"),i=(h=h.replace(/\n/g,"<br/>")).split(g.Y2.lineBreakRegex),j=1.25*(0,g.D7)().state.noteMargin;for(let a of i){let d=a.trim();if(d.length>0){let a=f.append("tspan");a.text(d),0===j&&(j+=a.node().getBBox().height),e+=j,a.attr("x",b+(0,g.D7)().state.noteMargin),a.attr("y",c+e+1.25*(0,g.D7)().state.noteMargin)}}return{textWidth:f.node().getBBox().width,textHeight:e}},"_drawLongText"),t=(0,h.K2)((a,b)=>{b.attr("class","state-note");let c=b.append("rect").attr("x",0).attr("y",(0,g.D7)().state.padding),{textWidth:d,textHeight:e}=s(a,0,0,b.append("g"));return c.attr("height",e+2*(0,g.D7)().state.noteMargin),c.attr("width",d+2*(0,g.D7)().state.noteMargin),c},"drawNote"),u=(0,h.K2)(function(a,b){let c=b.id,d={id:c,label:b.id,width:0,height:0},e=a.append("g").attr("id",c).attr("class","stateGroup");"start"===b.type&&l(e),"end"===b.type&&q(e),("fork"===b.type||"join"===b.type)&&r(e,b),"note"===b.type&&t(b.note.text,e),"divider"===b.type&&m(e),"default"===b.type&&0===b.descriptions.length&&n(e,b),"default"===b.type&&b.descriptions.length>0&&o(e,b);let f=e.node().getBBox();return d.width=f.width+2*(0,g.D7)().state.padding,d.height=f.height+2*(0,g.D7)().state.padding,d},"drawState"),v=0,w=(0,h.K2)(function(a,b,c){let d=(0,h.K2)(function(a){switch(a){case e.u4.relationType.AGGREGATION:return"aggregation";case e.u4.relationType.EXTENSION:return"extension";case e.u4.relationType.COMPOSITION:return"composition";case e.u4.relationType.DEPENDENCY:return"dependency"}},"getRelationType");b.points=b.points.filter(a=>!Number.isNaN(a.y));let j=b.points,k=(0,i.n8j)().x(function(a){return a.x}).y(function(a){return a.y}).curve(i.qrM),l=a.append("path").attr("d",k(j)).attr("id","edge"+v).attr("class","transition"),m="";if((0,g.D7)().state.arrowMarkerAbsolute&&(m=(0,g.ID)(!0)),l.attr("marker-end","url("+m+"#"+d(e.u4.relationType.DEPENDENCY)+"End)"),void 0!==c.title){let d=a.append("g").attr("class","stateLabel"),{x:e,y:i}=f._K.calcLabelPosition(b.points),j=g.Y2.getRows(c.title),k=0,l=[],m=0,n=0;for(let a=0;a<=j.length;a++){let b=d.append("text").attr("text-anchor","middle").text(j[a]).attr("x",e).attr("y",i+k),c=b.node().getBBox();m=Math.max(m,c.width),n=Math.min(n,c.x),h.Rm.info(c.x,e,i+k),0===k&&(k=b.node().getBBox().height,h.Rm.info("Title height",k,i)),l.push(b)}let o=k*j.length;if(j.length>1){let a=(j.length-1)*k*.5;l.forEach((b,c)=>b.attr("y",i+c*k-a)),o=k*j.length}let p=d.node().getBBox();d.insert("rect",":first-child").attr("class","box").attr("x",e-m/2-(0,g.D7)().state.padding/2).attr("y",i-o/2-(0,g.D7)().state.padding/2-3.5).attr("width",m+(0,g.D7)().state.padding).attr("height",o+(0,g.D7)().state.padding),h.Rm.info(p)}v++},"drawEdge"),x={},y=(0,h.K2)(function(){},"setConf"),z=(0,h.K2)(function(a){a.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),A=(0,h.K2)(function(a,b,c,e){let f;d=(0,g.D7)().state;let j=(0,g.D7)().securityLevel;"sandbox"===j&&(f=(0,i.Ltv)("#i"+b));let k="sandbox"===j?(0,i.Ltv)(f.nodes()[0].contentDocument.body):(0,i.Ltv)("body"),l="sandbox"===j?f.nodes()[0].contentDocument:document;h.Rm.debug("Rendering diagram "+a);let m=k.select(`[id='${b}']`);z(m),C(e.db.getRootDoc(),m,void 0,!1,k,l,e);let n=d.padding,o=m.node().getBBox(),p=o.width+2*n,q=o.height+2*n;(0,g.a$)(m,q,1.75*p,d.useMaxWidth),m.attr("viewBox",`${o.x-d.padding}  ${o.y-d.padding} `+p+" "+q)},"draw"),B=(0,h.K2)(a=>a?a.length*d.fontSizeFactor:1,"getLabelWidth"),C=(0,h.K2)((a,b,c,e,f,i,l)=>{let m,n=new k.T({compound:!0,multigraph:!0}),o=!0;for(m=0;m<a.length;m++)if("relation"===a[m].stmt){o=!1;break}c?n.setGraph({rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:o?1:d.edgeLengthFactor,nodeSep:o?1:50,isMultiGraph:!0}):n.setGraph({rankdir:"TB",multigraph:!0,compound:!0,ranksep:o?1:d.edgeLengthFactor,nodeSep:o?1:50,ranker:"tight-tree",isMultiGraph:!0}),n.setDefaultEdgeLabel(function(){return{}});let q=l.db.getStates(),r=l.db.getRelations();for(let a of Object.keys(q)){let g,h=q[a];if(c&&(h.parentId=c),h.doc){let a=b.append("g").attr("id",h.id).attr("class","stateGroup");g=C(h.doc,a,h.id,!e,f,i,l);{let b=(a=p(a,h,e)).node().getBBox();g.width=b.width,g.height=b.height+d.padding/2,x[h.id]={y:d.compositTitleSize}}}else g=u(b,h,n);if(h.note){let a=u(b,{descriptions:[],id:h.id+"-note",note:h.note,type:"note"},n);"left of"===h.note.position?(n.setNode(g.id+"-note",a),n.setNode(g.id,g)):(n.setNode(g.id,g),n.setNode(g.id+"-note",a)),n.setParent(g.id,g.id+"-group"),n.setParent(g.id+"-note",g.id+"-group")}else n.setNode(g.id,g)}h.Rm.debug("Count=",n.nodeCount(),n);let s=0;r.forEach(function(a){s++,h.Rm.debug("Setting edge",a),n.setEdge(a.id1,a.id2,{relation:a,width:B(a.title),height:d.labelHeight*g.Y2.getRows(a.title).length,labelpos:"c"},"id"+s)}),(0,j.Zp)(n),h.Rm.debug("Graph after layout",n.nodes());let t=b.node();n.nodes().forEach(function(a){void 0!==a&&void 0!==n.node(a)?(h.Rm.warn("Node "+a+": "+JSON.stringify(n.node(a))),f.select("#"+t.id+" #"+a).attr("transform","translate("+(n.node(a).x-n.node(a).width/2)+","+(n.node(a).y+(x[a]?x[a].y:0)-n.node(a).height/2)+" )"),f.select("#"+t.id+" #"+a).attr("data-x-shift",n.node(a).x-n.node(a).width/2),i.querySelectorAll("#"+t.id+" #"+a+" .divider").forEach(a=>{let b=a.parentElement,c=0,d=0;b&&(b.parentElement&&(c=b.parentElement.getBBox().width),Number.isNaN(d=parseInt(b.getAttribute("data-x-shift"),10))&&(d=0)),a.setAttribute("x1",0-d+8),a.setAttribute("x2",c-d-8)})):h.Rm.debug("No Node "+a+": "+JSON.stringify(n.node(a)))});let v=t.getBBox();n.edges().forEach(function(a){void 0!==a&&void 0!==n.edge(a)&&(h.Rm.debug("Edge "+a.v+" -> "+a.w+": "+JSON.stringify(n.edge(a))),w(b,n.edge(a),n.edge(a).relation))});let y={id:c||"root",label:c||"root",width:0,height:0};return y.width=(v=t.getBBox()).width+2*d.padding,y.height=v.height+2*d.padding,h.Rm.debug("Doc rendered",y,n),y},"renderDoc"),D={parser:e.Zk,get db(){return new e.u4(1)},renderer:{setConf:y,draw:A},styles:e.tM,init:(0,h.K2)(a=>{a.state||(a.state={}),a.state.arrowMarkerAbsolute=a.arrowMarkerAbsolute},"init")}}};